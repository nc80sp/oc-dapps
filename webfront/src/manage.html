<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>コントラクト送金ページ</title>
</head>

<body>
    <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
    <script src="ocpass.js"></script>

    <h1>コントラクトの残高確認 & 送金/引出 [※オーナーのみ実行可能]</h1>

    <div>
        <button onclick="getBalance()">残高を取得</button>
    </div>
    <p>コントラクト残高: <span id="balance">-</span> ETH</p>

    <div>
        <h3>送金</h3>
        <label>ETH 金額: </label>
        <input id="ethAmount" type="text" placeholder="0.01" />
        <button onclick="send()">送金する (※コントラクトへの送金)</button>
    </div>
    <div>
        <h3>引出</h3>
        <label>ETH 金額: </label>
        <input id="ethAmountRecv" type="text" placeholder="0.01" />
        <button onclick="withdrawAll()">引き出しする (※オーナーへの送金)</button>
    </div>

    <h1>有料ページの料金確認 & 設定 [※オーナーのみ実行可能]</h1>
    <div>
        <h3>金額確認</h3>
        <label>ページID: </label>
        <input id="getPayPageId" type="text" placeholder="1" />
        <button onclick="getPageFeeExec()">取得する</button><br />
        <p>金額: <span id="getPayPageFee">-</span> ETH</p>
    </div>
    <div>
        <h3>金額設定</h3>
        <label>ページID: </label>
        <input id="setPayPageId" type="text" placeholder="1" /><br />
        <label>金額: </label>
        <input id="setPayPageFee" type="text" placeholder="0.01" />
        <button onclick="setPageFeeExec()">設定する</button><br />
        <p><span id="setPayPageFeeResult"></span> </p>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", async () => {
            await connectWallet();
        });

        async function getBalance() {
            document.getElementById("balance").innerText = await getContractBalance();
        }

        async function send() {
            try {
                const amount = document.getElementById("ethAmount").value;
                await sendEth(amount);
            } catch (e) {
                alert("送金エラー: " + e.message);
            }
        }

        async function withdrawAll() {
            try {
                const amount = document.getElementById("ethAmountRecv").value;
                await withdraw(amount);
                await getBalance();
            } catch (e) {
                alert("引き出しエラー: " + e.message);
            }
        }

        async function getPageFeeExec() {
            try {
                const pageId = document.getElementById("getPayPageId").value;
                let fee = await getPageFee(Number(pageId));
                document.getElementById("getPayPageFee").innerText = fee;
            } catch (e) {
                alert("送金エラー: " + e.message);
            }
        }

        async function setPageFeeExec() {
            try {
                const pageId = document.getElementById("setPayPageId").value;
                const fee = document.getElementById("setPayPageFee").value;
                await setPageFee(pageId, fee);
                document.getElementById("setPayPageFeeResult").innerText = "設定完了";
            } catch (e) {
                alert("送金エラー: " + e.message);
            }
        }
    </script>
</body>

</html>