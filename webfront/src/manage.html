<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>コントラクト送金ページ</title>
    <style>
        .hr1 {
            position: relative;
            height: 3px;
            border-width: 0;
            background-color: #00bcd4;
            background-image: -webkit-linear-gradient(135deg, #FD6585 10%, #0D25B9 100%);
            background-image: linear-gradient(135deg, #FD6585 10%, #0D25B9 100%);
        }
    </style>
</head>

<body>
    <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
    <script src="ocpass.js"></script>
    <hr class="hr1">
    <h1>コントラクトの残高確認 & 送金/引出</h1>

    <div>
        <button onclick="getBalance()">残高を取得</button>
    </div>
    <p>コントラクト残高: <span id="balance">-</span> ETH</p>

    <div>
        <h3>送金</h3>
        <label>ETH 金額: </label>
        <input id="ethAmount" type="text" placeholder="0.01" />
        <button onclick="send()">送金する</button>
    </div>
    <div>
        <h3>引出</h3>
        <label>ETH 金額: </label>
        <input id="ethAmountRecv" type="text" placeholder="0.01" />
        <button onclick="withdrawAll()">引き出しする (※オーナーへの送金)</button>
    </div>

    <hr class="hr1">
    <h1>有料ページの料金確認 & 設定</h1>
    <div>
        <h3>金額確認</h3>
        <label>ページID: </label>
        <input id="getPayPageId" type="text" placeholder="1" />
        <button onclick="getPageFeeExec()">取得する</button><br />
        <p>金額: <span id="getPayPageFee">-</span> ETH</p>
    </div>
    <div>
        <h3>金額設定</h3>
        <label>ページID: </label>
        <input id="setPayPageId" type="text" placeholder="1" /><br />
        <label>金額: </label>
        <input id="setPayPageFee" type="text" placeholder="0.01" />
        <button onclick="setPageFeeExec()">設定する</button><br />
        <p><span id="setPayPageFeeResult"></span> </p>
    </div>

    <hr class="hr1">
    <h1>NFTのメタデータURL設定</h1>
    <div>
        <label>TypeID (1:参加証、2:試験合格証): </label>
        <input id="NFTMetaTypeID" type="text" placeholder="1" /><br />
        <label>URL: </label>
        <input id="NFTMetaURL" type="text" placeholder="https://..." />
        <button onclick="setMetadata()">設定する</button><br />
        <p><span id="NftMetadataResult"></span> </p>
    </div>
    <hr class="hr1">
    <h1>NFTのメタデータURL取得</h1>
    <div>
        <label>TypeID (1:参加証、2:試験合格証): </label>
        <input id="GetMetaTypeID" type="text" placeholder="1" /><br />
        <button onclick="getMetadata()">取得する</button><br />
        <p><span id="GetMetadataResult"></span> </p>
    </div>

    <hr class="hr1">
    <h1>NFT発行数の確認</h1>
    <div>
        <label>TypeID (1:参加証、2:試験合格証): </label>
        <input id="NFTMetaTypeIDNum" type="text" placeholder="1" />
        <button onclick="getNFTNum()">取得する</button><br />
        <p><span id="getNFTNumResult"></span></p>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", async () => {
            await connectWallet(false);
        });

        async function getBalance() {
            document.getElementById("balance").innerText = await getContractBalance();
        }

        async function send() {
            try {
                const amount = document.getElementById("ethAmount").value;
                await sendEth(amount);
            } catch (e) {
                alert("送金エラー: " + e.message);
            }
        }

        async function withdrawAll() {
            try {
                const amount = document.getElementById("ethAmountRecv").value;
                await withdraw(amount);
                await getBalance();
            } catch (e) {
                alert("引き出しエラー: " + e.message);
            }
        }

        async function getPageFeeExec() {
            try {
                const pageId = document.getElementById("getPayPageId").value;
                let fee = await getPageFee(Number(pageId));
                document.getElementById("getPayPageFee").innerText = fee;
            } catch (e) {
                alert("エラー: " + e.message);
            }
        }

        async function setPageFeeExec() {
            try {
                const pageId = document.getElementById("setPayPageId").value;
                const fee = document.getElementById("setPayPageFee").value;
                await setPageFee(pageId, fee);
                document.getElementById("setPayPageFeeResult").innerText = "設定完了";
            } catch (e) {
                alert("エラー: " + e.message);
            }
        }

        async function getMetadata() {
            try {
                const typeId = document.getElementById("GetMetaTypeID").value;
                let uri = await getMetadataURI(typeId);
                document.getElementById("GetMetadataResult").innerText = uri;
            } catch (e) {
                alert("エラー: " + e.message);
            }
        }

        async function setMetadata() {
            try {
                const typeId = document.getElementById("NFTMetaTypeID").value;
                const url = document.getElementById("NFTMetaURL").value;
                await setMetadataURI(typeId, url);
                document.getElementById("NftMetadataResult").innerText = "設定完了";
            } catch (e) {
                alert("エラー: " + e.message);
            }
        }

        async function getNFTNum() {
            try {
                const typeId = document.getElementById("NFTMetaTypeIDNum").value;
                const num = await getMintNum(typeId);
                document.getElementById("getNFTNumResult").innerText = num;
            } catch (e) {
                alert("エラー: " + e.message);
            }
        }
    </script>
</body>

</html>